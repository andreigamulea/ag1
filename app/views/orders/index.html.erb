<!-- app/views/orders/index.html.erb -->
<div class="orders-page-wrapper">
  <!-- Titlul principal pe toată lățimea -->
  <div class="page-header">
    <h1>Administrare Comenzi</h1>
  </div>

  <!-- Containerul cu cele două coloane -->
  <div class="orders-container">
    <div class="orders-row">
      <!-- Coloana stângă: Tabelul cu ordine -->
      <div class="orders-table-column">
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nume</th>
              <th>Email</th>
              <th>Telefon</th>
              <th>Data Creării</th>
              <th>Total</th>
              <th>Status</th>
              <th>Acțiuni</th>
            </tr>
          </thead>
          <tbody>
            <% @orders.each do |order| %>
              <tr>
                <td><%= order.id %></td>
                <td><%= "#{order.first_name} #{order.last_name}" %></td>
                <td><%= order.email %></td>
                <td><%= order.phone %></td>
                <td><%= order.created_at.strftime("%d/%m/%Y %H:%M") %></td>
                <td><%= order.total %> RON</td>
                <td><%= order.status %></td>
                <td>
                  <div class="action-buttons">
                    <%= button_to "Produse", show_items_order_path(order), remote: true, class: "btn btn-primary btn-sm", data: { target: order.id } %>
                    <% if order.invoice.present? %>
                      <%= link_to "PDF", invoice_order_path(order, format: :pdf), class: "btn btn-secondary btn-sm" %>
                      <%= link_to "XML", invoice_order_path(order, format: :xml), class: "btn btn-info btn-sm" %>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <div class="orders-pagination-wrapper">
          <%= paginate @orders %>
        </div>
      </div>

      <!-- Coloana dreaptă: Detalii ordin -->
      <div class="order-details-column" id="order-items-container">
        <h2>Detalii Ordin</h2>
        <p>Selectează un ordin pentru a vedea produsele.</p>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript pentru a gestiona încărcarea AJAX -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('button[data-target]').forEach(button => {
      button.addEventListener('click', function(event) {
        event.preventDefault();
        const orderId = this.dataset.target;
        const url = `/orders/${orderId}/show_items`;

        fetch(url, {
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => response.text())
        .then(html => {
          document.getElementById('order-items-container').innerHTML = html;
        })
        .catch(error => console.error('Error:', error));
      });
    });
  });
</script>
