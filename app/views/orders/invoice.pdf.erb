<!-- app/views/orders/invoice.pdf.erb -->
<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Factură #<%= invoice.invoice_number %></title> <!-- Schimbat să folosească invoice_number -->
  <style>
    body { font-family: Arial, sans-serif; font-size: 12pt; margin: 20mm; }
    h1 { text-align: center; }
    .info { margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #000; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .total { font-weight: bold; }
    .footer { text-align: center; font-size: 10pt; }
  </style>
</head>
<body>
  <h1>Factură #<%= invoice.invoice_number %></h1> <!-- Schimbat să folosească invoice_number -->

  <div class="info">
    <p><strong>Data emisă:</strong> <%= order.created_at.strftime("%d/%m/%Y") %></p>
    <p><strong>Cumpărător:</strong> <%= "#{order.first_name} #{order.last_name}" %></p>
    <% if order.company_name.present? %>
      <p><strong>Companie:</strong> <%= order.company_name %></p>
      <p><strong>CUI:</strong> <%= order.cui %></p>
    <% end %>
    <% if order.cnp.present? %>
      <p><strong>CNP:</strong> <%= order.cnp %></p>
    <% end %>
    <p><strong>Adresă facturare:</strong> <%= "#{order.street} #{order.street_number}, #{order.block_details}, #{order.city}, #{order.county}, #{order.postal_code}, #{order.country}" %></p>
    <p><strong>Email:</strong> <%= order.email %></p>
    <p><strong>Telefon:</strong> <%= order.phone %></p>
    <% if order.use_different_shipping %>
      <p><strong>Adresă livrare:</strong> <%= "#{order.shipping_street} #{order.shipping_street_number}, #{order.shipping_block_details}, #{order.shipping_city}, #{order.shipping_county}, #{order.shipping_postal_code}, #{order.shipping_country}" %></p>
      <p><strong>Telefon livrare:</strong> <%= order.shipping_phone %></p>
    <% end %>
    <p><strong>Note:</strong> <%= order.notes %></p>
  </div>

  <h2>Detalii Comandă</h2>
  <table>
    <thead>
      <tr>
        <th>Produs</th>
        <th>Cantitate</th>
        <th>Preț Unitate (RON)</th>
        <th>Total (RON)</th>
      </tr>
    </thead>
    <tbody>
      <% order.order_items.each do |item| %>
        <tr>
          <td><%= item.product_name %></td>
          <td><%= item.quantity %></td>
          <td><%= sprintf("%.2f", item.price) %></td>
          <td><%= sprintf("%.2f", item.total_price) %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr class="total">
        <td colspan="3">Subtotal:</td>
        <td><%= sprintf("%.2f", order.order_items.where.not(product_name: ["Discount", "Transport"]).sum(:total_price)) %></td>
      </tr>
      <tr class="total">
        <td colspan="3">Discount:</td>
        <td><%= sprintf("%.2f", order.order_items.find_by(product_name: "Discount")&.total_price || 0) %></td>
      </tr>
      <tr class="total">
        <td colspan="3">Transport:</td>
        <td><%= sprintf("%.2f", order.order_items.find_by(product_name: "Transport")&.total_price || 0) %></td>
      </tr>
      <tr class="total">
        <td colspan="3">Total:</td>
        <td><%= sprintf("%.2f", order.total) %></td>
      </tr>
    </tfoot>
  </table>

  <div class="footer">
    <p>Mulțumim pentru comandă! Pentru întrebări, contactați-ne la [email magazin].</p>
  </div>
</body>
</html>