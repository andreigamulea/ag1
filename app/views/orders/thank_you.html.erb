<div class="thank-you-wrapper">
  <!-- SUCCESS HEADER -->
  <div class="success-header">
    <div class="success-icon">✅</div>
    <h1>Mulțumim pentru comandă!</h1>
    <p class="order-number">Comanda #<%= @order.id %> a fost plasată cu succes.</p>
  </div>

  <!-- CLIENT DETAILS -->
  <div class="info-section">
    <h2>Detalii client</h2>
    <ul>
      <li><strong>Nume:</strong> <%= @order.last_name %> <%= @order.first_name %></li>
      <li><strong>Email:</strong> <%= @order.email %></li>
      <li><strong>Telefon:</strong> <%= @order.phone %></li>
      <li><strong>Adresă:</strong> <%= [@order.street, "nr #{@order.street_number}", @order.block_details, @order.city, @order.county, @order.country].compact.join(', ') %> (Cod poștal: <%= @order.postal_code %>)</li>
    </ul>
  </div>

  <!-- SHIPPING ADDRESS (if different) -->
  <% if @order.shipping_address_different? %>
    <div class="info-section">
      <h2>Adresă de livrare</h2>
      <ul>
        <li><strong>Nume:</strong> <%= @order.shipping_last_name %> <%= @order.shipping_first_name %></li>
        <li><strong>Telefon:</strong> <%= @order.shipping_phone %></li>
        <li><strong>Adresă:</strong> <%= [@order.shipping_street, "nr #{@order.shipping_street_number}", @order.shipping_block_details, @order.shipping_city, @order.shipping_county, @order.shipping_country].compact.join(', ') %> (Cod poștal: <%= @order.shipping_postal_code %>)</li>
      </ul>
    </div>
  <% end %>

  <!-- PRODUCTS TABLE -->
  <div class="products-section">
    <h2>Produse comandate</h2>
    <table class="products-table">
      <thead>
        <tr>
          <th>Produs</th>
          <th>Cantitate</th>
          <th>Preț unitar</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <% transport_item = @order.order_items.find { |i| i.product_name == "Transport" } %>

        <% @order.order_items.each do |item| %>
          <% next if item.product_name == "Transport" %>
          <tr class="<%= 'discount-row' if item.product_name == 'Discount' %>">
            <td><%= item.product_name %></td>
            <td><%= item.quantity %></td>
            <td>
              <% unit_price = item.total_price.to_f / item.quantity.to_i rescue 0 %>
              <% if item.product_name == "Discount" %>
                -<%= number_with_precision(unit_price.abs, precision: 2) %> lei
              <% else %>
                <%= number_with_precision(unit_price, precision: 2) %> lei
              <% end %>
            </td>
            <td>
              <% if item.product_name == "Discount" %>
                -<%= number_with_precision(item.total_price.to_f.abs, precision: 2) %> lei
              <% else %>
                <%= number_with_precision(item.total_price.to_f, precision: 2) %> lei
              <% end %>
            </td>
          </tr>
        <% end %>

        <!-- Transport Row -->
        <tr>
          <td>Transport</td>
          <td>1</td>
          <% if transport_item && transport_item.total_price.to_f > 0 %>
            <td><%= number_with_precision(transport_item.total_price.to_f, precision: 2) %> lei</td>
            <td><%= number_with_precision(transport_item.total_price.to_f, precision: 2) %> lei</td>
          <% else %>
            <td class="transport-free">Gratuit</td>
            <td>0.00 lei</td>
          <% end %>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- PAYMENT SUMMARY -->
  <div class="payment-summary">
    <h3>Rezumat plată</h3>
    <ul>
      <li>Subtotal: <%= number_with_precision(@subtotal || 0, precision: 2) %> lei</li>

      <% if @discount.to_f != 0 %>
        <li class="discount-amount">Reducere: -<%= number_with_precision(@discount.to_f.abs, precision: 2) %> lei</li>
      <% end %>

      <% if @transport.to_f != 0 %>
        <li>Transport: <%= number_with_precision(@transport, precision: 2) %> lei</li>
      <% else %>
        <li class="free-shipping">Transport: Gratuit</li>
      <% end %>

      <li class="total-amount"><strong>Total de plată: <%= number_with_precision(@total || 0, precision: 2) %> lei</strong></li>
    </ul>
  </div>

  <!-- CONFIRMATION MESSAGE -->
  <div class="confirmation-message">
    <p>✉️ Vei primi un email de confirmare cu detaliile comenzii în curând.</p>
  </div>

  <!-- BACK BUTTON -->
  <div class="back-button-container">
    <%= link_to "Înapoi la homepage", root_path, class: "btn-back" %>
  </div>
</div>
